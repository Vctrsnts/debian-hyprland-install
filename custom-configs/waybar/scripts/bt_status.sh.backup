#!/bin/bash

# Dirección MAC de los auriculares
MAC="84:0F:2A:9A:3D:E5"

# Verifica si están conectados
CONNECTED=$(bluetoothctl info "$MAC" | grep "Connected: yes")

if [ -n "$CONNECTED" ]; then
    # Batería desde journalctl
    BATTERY=$(journalctl --user -n 50 | grep "Battery Level" | tail -n1 | sed -n 's/.*Battery Level: \([0-9]\+\)%.*/\1/p')

    # Volumen actual
    VOLUME=$(pactl get-sink-volume @DEFAULT_SINK@ | grep -o '[0-9]\+%' | head -n1)

    # Construir tooltip
    TOOLTIP="󰥉 ${BATTERY}%  ${VOLUME}"

    # Mostrar icono Bluetooth en la barra
    echo "{\"text\": \"󰂯\", \"tooltip\": \"$TOOLTIP\"}"
else
    echo "{\"text\": \"\", \"tooltip\": \"No conectado\"}"
fi
